Transcription of [[course-zoomcamp/03-classification/notes/notebook#3 3 Setting up the validation framework]]
# 3.3 Setting up the validation framework

* Perform the train/validation/test split with Scikit-Learn

Recall that we split into train/validation/split in NumPy/Pandas. Now we will do so in **Scikit-Learn**.

Scikit-Learn is one of the most popular machine learning libraries and implements many popular algorithms and common utilities. We'll use it for train-test splitting.

```python
from sklearn.model_selection import train_test_split
```

Can use **?** in notebooks to see documentation

```python
train_test_split?
```

    Split arrays or matrices into random train and test subsets.
    
    Quick utility that wraps input validation and
    ``next(ShuffleSplit().split(X, y))`` and application to input data
    into a single call for splitting (and optionally subsampling) data in a
    oneliner.
    
    Read more in the :ref:`User Guide <cross_validation>`.
    
    Parameters
    ----------
    *arrays : sequence of indexables with same length / shape[0]
        Allowed inputs are lists, numpy arrays, scipy-sparse
        matrices or pandas dataframes.
    
    test_size : float or int, default=None
        If float, should be between 0.0 and 1.0 and represent the proportion
        of the dataset to include in the test split. If int, represents the
        absolute number of test samples. If None, the value is set to the
        complement of the train size. If ``train_size`` is also None, it will
        be set to 0.25.
    
    train_size : float or int, default=None
        If float, should be between 0.0 and 1.0 and represent the
        proportion of the dataset to include in the train split. If
        int, represents the absolute number of train samples. If None,
        the value is automatically set to the complement of the test size.
    
    random_state : int, RandomState instance or None, default=None
        Controls the shuffling applied to the data before applying the split.
        Pass an int for reproducible output across multiple function calls.
        See :term:`Glossary <random_state>`.
    
    shuffle : bool, default=True
        Whether or not to shuffle the data before splitting. If shuffle=False
        then stratify must be None.
    
    stratify : array-like, default=None
        If not None, data is split in a stratified fashion, using this as
        the class labels.
        Read more in the :ref:`User Guide <stratification>`.
    
    Returns
    -------
    splitting : list, length=2 * len(arrays)
        List containing train-test split of inputs.
    
        .. versionadded:: 0.16
            If the input is sparse, the output will be a
            ``scipy.sparse.csr_matrix``. Else, output type is the same as the
            input type.
    
    Examples
    --------
    >>> import numpy as np
    >>> from sklearn.model_selection import train_test_split
    >>> X, y = np.arange(10).reshape((5, 2)), range(5)
    >>> X
    array([[0, 1],
           [2, 3],
           [4, 5],
           [6, 7],
           [8, 9]])
    >>> list(y)
    [0, 1, 2, 3, 4]
    
    >>> X_train, X_test, y_train, y_test = train_test_split(
    ...     X, y, test_size=0.33, random_state=42)
    ...
    >>> X_train
    array([[4, 5],
           [0, 1],
           [6, 7]])
    >>> y_train
    [2, 0, 3]
    >>> X_test
    array([[2, 3],
           [8, 9]])
    >>> y_test
    [1, 4]
    
    >>> train_test_split(y, shuffle=False)
    [[0, 1, 2], [3, 4]]
    [0;31mFile:[0m      ~/anaconda3/envs/exp-tracking-env/lib/python3.9/site-packages/sklearn/model_selection/_split.py
    [0;31mType:[0m      function


We will use test_size to specify the test size split (20%) and random_state for repeatability.

Will split it two times; once to get the test set and once more to get train and validation sets.

```python
df_full_train, df_test = train_test_split(df, test_size=0.2, random_state=1)
```

Let's see the test set size

```python
len(df_full_train), len(df_test)
```




    (5634, 1409)



```python
# Note that we need 25% split to get 20% of the original dataset size.
df_train, df_val = train_test_split(df_full_train, test_size=0.25, random_state=1)
len(df_train), len(df_val), len(df_test)
```




    (4225, 1409, 1409)



We can see test/val datasets have the same size, and train dataset has 4225 examples.

Now let us get the target variables.

```python
df_train
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>customerid</th>
      <th>gender</th>
      <th>seniorcitizen</th>
      <th>partner</th>
      <th>dependents</th>
      <th>tenure</th>
      <th>phoneservice</th>
      <th>multiplelines</th>
      <th>internetservice</th>
      <th>onlinesecurity</th>
      <th>...</th>
      <th>deviceprotection</th>
      <th>techsupport</th>
      <th>streamingtv</th>
      <th>streamingmovies</th>
      <th>contract</th>
      <th>paperlessbilling</th>
      <th>paymentmethod</th>
      <th>monthlycharges</th>
      <th>totalcharges</th>
      <th>churn</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3897</th>
      <td>8015-ihcgw</td>
      <td>female</td>
      <td>0</td>
      <td>yes</td>
      <td>yes</td>
      <td>72</td>
      <td>yes</td>
      <td>yes</td>
      <td>fiber_optic</td>
      <td>yes</td>
      <td>...</td>
      <td>yes</td>
      <td>yes</td>
      <td>yes</td>
      <td>yes</td>
      <td>two_year</td>
      <td>yes</td>
      <td>electronic_check</td>
      <td>115.50</td>
      <td>8425.15</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1980</th>
      <td>1960-uycnn</td>
      <td>male</td>
      <td>0</td>
      <td>no</td>
      <td>no</td>
      <td>10</td>
      <td>yes</td>
      <td>yes</td>
      <td>fiber_optic</td>
      <td>no</td>
      <td>...</td>
      <td>yes</td>
      <td>no</td>
      <td>no</td>
      <td>yes</td>
      <td>month-to-month</td>
      <td>yes</td>
      <td>electronic_check</td>
      <td>95.25</td>
      <td>1021.55</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6302</th>
      <td>9250-wypll</td>
      <td>female</td>
      <td>0</td>
      <td>no</td>
      <td>no</td>
      <td>5</td>
      <td>yes</td>
      <td>yes</td>
      <td>fiber_optic</td>
      <td>no</td>
      <td>...</td>
      <td>no</td>
      <td>no</td>
      <td>no</td>
      <td>no</td>
      <td>month-to-month</td>
      <td>no</td>
      <td>electronic_check</td>
      <td>75.55</td>
      <td>413.65</td>
      <td>1</td>
    </tr>
    <tr>
      <th>727</th>
      <td>6786-obwqr</td>
      <td>female</td>
      <td>0</td>
      <td>yes</td>
      <td>yes</td>
      <td>5</td>
      <td>yes</td>
      <td>no</td>
      <td>fiber_optic</td>
      <td>no</td>
      <td>...</td>
      <td>no</td>
      <td>no</td>
      <td>yes</td>
      <td>no</td>
      <td>month-to-month</td>
      <td>yes</td>
      <td>electronic_check</td>
      <td>80.85</td>
      <td>356.10</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5104</th>
      <td>1328-euzhc</td>
      <td>female</td>
      <td>0</td>
      <td>yes</td>
      <td>no</td>
      <td>18</td>
      <td>yes</td>
      <td>no</td>
      <td>no</td>
      <td>no_internet_service</td>
      <td>...</td>
      <td>no_internet_service</td>
      <td>no_internet_service</td>
      <td>no_internet_service</td>
      <td>no_internet_service</td>
      <td>two_year</td>
      <td>no</td>
      <td>mailed_check</td>
      <td>20.10</td>
      <td>370.50</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3774</th>
      <td>1309-xgfsn</td>
      <td>male</td>
      <td>1</td>
      <td>yes</td>
      <td>yes</td>
      <td>52</td>
      <td>yes</td>
      <td>yes</td>
      <td>dsl</td>
      <td>no</td>
      <td>...</td>
      <td>yes</td>
      <td>no</td>
      <td>yes</td>
      <td>yes</td>
      <td>one_year</td>
      <td>yes</td>
      <td>electronic_check</td>
      <td>80.85</td>
      <td>4079.55</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6108</th>
      <td>4819-hjpiw</td>
      <td>male</td>
      <td>0</td>
      <td>no</td>
      <td>no</td>
      <td>18</td>
      <td>no</td>
      <td>no_phone_service</td>
      <td>dsl</td>
      <td>no</td>
      <td>...</td>
      <td>no</td>
      <td>no</td>
      <td>no</td>
      <td>no</td>
      <td>month-to-month</td>
      <td>no</td>
      <td>mailed_check</td>
      <td>25.15</td>
      <td>476.80</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1530</th>
      <td>3703-vavcl</td>
      <td>male</td>
      <td>0</td>
      <td>yes</td>
      <td>yes</td>
      <td>2</td>
      <td>yes</td>
      <td>no</td>
      <td>fiber_optic</td>
      <td>no</td>
      <td>...</td>
      <td>yes</td>
      <td>yes</td>
      <td>no</td>
      <td>yes</td>
      <td>month-to-month</td>
      <td>no</td>
      <td>credit_card_(automatic)</td>
      <td>90.00</td>
      <td>190.05</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3701</th>
      <td>3812-lrzir</td>
      <td>female</td>
      <td>0</td>
      <td>yes</td>
      <td>yes</td>
      <td>27</td>
      <td>yes</td>
      <td>yes</td>
      <td>no</td>
      <td>no_internet_service</td>
      <td>...</td>
      <td>no_internet_service</td>
      <td>no_internet_service</td>
      <td>no_internet_service</td>
      <td>no_internet_service</td>
      <td>two_year</td>
      <td>no</td>
      <td>electronic_check</td>
      <td>24.50</td>
      <td>761.95</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4368</th>
      <td>1704-nrwye</td>
      <td>female</td>
      <td>1</td>
      <td>no</td>
      <td>no</td>
      <td>9</td>
      <td>yes</td>
      <td>no</td>
      <td>fiber_optic</td>
      <td>no</td>
      <td>...</td>
      <td>no</td>
      <td>no</td>
      <td>yes</td>
      <td>no</td>
      <td>month-to-month</td>
      <td>yes</td>
      <td>electronic_check</td>
      <td>80.85</td>
      <td>751.65</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>4225 rows × 21 columns</p>
</div>



Do not have to do this (does not affect ML model), but it is nicer when the indices are not shuffled.

```python
df_train = df_train.reset_index(drop=True)
df_val = df_val.reset_index(drop=True)
df_test = df_test.reset_index(drop=True)
```

Again, use underlying NumPy array to grab values then delete from DataFrames

```python
y_train = df_train.churn.values
y_val = df_val.churn.values
y_test = df_test.churn.values

del df_train['churn']
del df_val['churn']
del df_test['churn']
```

Helps us not accidentally use target variable when training the model.

May notice we did not delete target variable from the full dataframe (df_full_train). The reason for that is that we will look at the target variable more in the next lesson.

# Summary

* `wget` - Linux shell command for downloading data. 
* `train_test_split` - Scikit-Learn class for splitting datasets. The `random_state` argument set a random seed for reproducibility purposes.  
* `df.reset_index(drop=True)` - reset the indices of a dataframe and delete the previous ones. 
* `df.x.values` - extract the values from x series
* `del df['x']` - delete x series from a dataframe 