Transcription of [[course-zoomcamp/03-classification/notes/notebook#3 7 Feature importance Correlation]]
# 3.7 Feature importance: Correlation

How about numerical columns?

* Correlation coefficient - https://en.wikipedia.org/wiki/Pearson_correlation_coefficient

Also known as Pearson's Correlation. Way to measure degree of dependency between two variables.
- Denoting correlation as *r*, -1 <= *r* <= 1
    - Positive correlation means they are proportional by a factor of abs(*r*)
    - Negative correlation means they are inversely proportional by a factor of abs(*r*)

E.g. variable *x* and *y*.
- Positive correlation means that as *x* grows, *y* grows as well
    - Negative correlation means that as *x* grows, *y* shrinks
- When correlation is between 0 and abs(0.1), the correlation is **low**
    - Increase in *x* rarely leads to an increase in *y*
    - When correlation is between 0.2 and 0.5 or -0.2 and 0.5, the correlation is **moderate**
        - Increase in *x* sometimes leads to an increase in *y*
    - When correlation is between 0.6 and 1.0 or -0.6 and 1.0, the correlation is **strong**
        - Increase in *x* often/always leads to an increase in *y*

In this case
- *y<sub>i</sub>* ∈ {0, 1}
- -∞ < *x* < ∞, *x* ∈ ℝ

E.g. *x* is tenure, *y* is churn.
- 0 < *x* <= 72
- For a positive correlation, if tenure ↑ then churn ↑
    - If *x* ↑ then *y* ↑.
- For a negative correlation, if tenure ↑ then churn ↓
    - If *x* ↑ then *y* ↓.
- For zero correlation, tenure does not really affect churn
    - *x* does not really affect *y*.

```python
df_full_train.tenure.max()
```




    72



Select numerical values, check the correlation between those and churn.

```python
df_full_train[numerical].corrwith(df_full_train.churn)#.abs
```




    tenure           -0.351885
    monthlycharges    0.196805
    totalcharges     -0.196353
    dtype: float64



The longer tenure or totalcharges, the less likely churn is (negative correlation).
- These are correlated, the longer you stay with a company the higher the total charges are.

With high monthly charges, the more likely one is to churn (positive correlation).

Can show this with tenure:

```python
# People with the company for 0, 1 or 2 months
tenure_low = df_full_train[df_full_train.tenure <= 2].churn.mean()
tenure_low
```




    0.5953420669577875



Churn rate is high for people with the company 2 months or less. But between 2 and 12 months:

```python
tenure_med = df_full_train[(df_full_train.tenure > 2) & (df_full_train.tenure <= 12)].churn.mean()
tenure_med
```




    0.3994413407821229



Churn rate is still pretty high but lower between 2 and 12 months. For more than a year:

```python
tenure_long = df_full_train[df_full_train.tenure > 12].churn.mean()
tenure_long
```




    0.17634908339788277



Churn rate is much lower after a year.

```python
labels = ['<2 Months', '2-12 Months', '>1 Year']

x = np.arange(len(labels))  # the label locations

fig, ax = plt.subplots()
rects = ax.bar(x, 
    [
        round(tenure_low, 4),
        round(tenure_med, 4),
        round(tenure_long, 4),
    ], 
    width = 0.75,
)

# Add some text for labels, title and custom x-axis tick labels, etc.
ax.margins(0.25)
ax.set_ylabel('Churn Rate')
ax.set_title('Churn Rate by Tenure')
ax.set_xticks(x, labels)

ax.bar_label(rects, padding=4)

fig.tight_layout()

plt.show()
```


    
![png](notebook_files/notebook_141_0.png)
    


Now let's look for monthly charges

For monthly charges less than $20:

```python
charges_low = df_full_train[df_full_train.monthlycharges <= 20].churn.mean()
charges_low
```




    0.08795411089866156



Churn rate is just less than 9%. Between $20 and $50:

```python
charges_med = \
    df_full_train[(df_full_train.monthlycharges > 20) & (df_full_train.monthlycharges <= 50)].churn.mean()
charges_med
```




    0.18340943683409436



Churn rate is 18%. For charges above $50:

```python
charges_high = df_full_train[df_full_train.monthlycharges > 50].churn.mean()
charges_high
```




    0.32499341585462205



Churn rate is 32.5%. This is much more important

```python
labels = ['<$20/Month', '\$20-\$50/Month', '>$50/Month']

x = np.arange(len(labels))  # the label locations

fig, ax = plt.subplots()
rects = ax.bar(x, 
    [
        round(charges_low, 4),
        round(charges_med, 4),
        round(charges_high, 4),
    ], 
    width = 0.75,
)

# Add some text for labels, title and custom x-axis tick labels, etc.
ax.margins(0.25)
ax.set_ylabel('Churn Rate')
ax.set_title('Churn Rate by Monthly Charges')
ax.set_xticks(x, labels)

ax.bar_label(rects, padding=4)

fig.tight_layout()

plt.show()
```


    
![png](notebook_files/notebook_150_0.png)
    


Overall we can see that tenure has a **negative correlation**, monthly charges has a **positive correlation**.

Also shows how much the variable affects churn. Can simply see the absolute value to just see effect:

```python
df_full_train[numerical].corrwith(df_full_train.churn).abs()
```




    tenure            0.351885
    monthlycharges    0.196805
    totalcharges      0.196353
    dtype: float64

# Summary

**Correlation coefficient**: measures the degree of dependency between two variables.

If `r` is correlation coefficient, then the correlation between two variables is:
- Positive correlation means they are proportional by a factor of abs(*r*)
- Negative correlation means they are inversely proportional by a factor of abs(*r*)